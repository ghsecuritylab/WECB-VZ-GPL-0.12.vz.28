<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Wireless Setup - Basic Settings</title>
  <%actInclude("wcb_common.html")%>
  
  <SCRIPT LANGUAGE="JavaScript">

var apenb=<% getVirtualIndex("wlanDisabled", "0"); %>;
var apfreq="2.4 GHz (B)";
var apchannel=0;
var apmode="AP";
var apsecmode="Disabled";
var mode = <% getVirtualIndex("encrypt", "0") %>;
var apssid="<% getVirtualInfo("ssid", "0"); %>";
var apwep = "<% getVirtualInfo("wps_key", "0"); %>";
var appsk = "<% getVirtualInfo("pskValue", "0") %>";
var appsk2 = "<% getVirtualInfo("wapiPskValue", "0") %>";
var coexist = <% getIndex("coexist"); %>;
var chanwidth = <% getIndex("ChannelBonding"); %>;
var client_status = "";

var wlan_num = <% getIndex("wlan_num"); %>;
var isNewMeshUI =  <% getIndex("isNewMeshUI"); %>;
var wlanMode = new Array();
var wlanDisabled = new Array();
var networkType = new Array();
var band = new Array();
var channel = new Array();
var wep = new Array();
var wdsEncrypt = new Array();
var meshEncrypt = new Array();
var state_drv=new Array();

if (wlan_num > 0)
{
	wlanMode[0] = <%getIndex("wlanMode");%>;
	wlanDisabled[0] = <%getIndex("wlanDisabled");%>;
	networkType[0] = <%getIndex("networkType");%>;
	band[0] = <%getIndex("band");%>;
	channel[0] =<%getInfo("channel");%>;
	wep[0] ='<%getInfo("wep");%>';
	wdsEncrypt[0] ='<%getInfo("wdsEncrypt");%>';
	
	if (<%getIndex("isMeshDefined");%> == 1)
		meshEncrypt[0] ='<%getInfo("meshEncrypt");%>';
	else
		meshEncrypt[0] ='';
	state_drv[0] ='<%getInfo("state_drv");%>';
}

if (wlan_num > 1)
{
	wlanMode[1] = <%getIndex("wlanMode");%>;
	wlanDisabled[1] = <%getIndex("wlanDisabled");%>;
	networkType[1] = <%getIndex("networkType");%>;
	band[1] = <%getIndex("band");%>;
	channel[1] =<%getInfo("channel");%>;
	wep[1] ='<%getInfo("wep");%>';
	wdsEncrypt[1] ='<%getInfo("wdsEncrypt");%>';

	if (<%getIndex("isMeshDefined");%> == 1)
		meshEncrypt[1] ='<%getInfo("meshEncrypt");%>';
	else
		meshEncrypt[1] ='';
	state_drv[1] ='<%getInfo("state_drv");%>';
}

for(var i = 0; i < wlan_num; i++)
{
	if(wlanDisabled[i] == 1)
		continue;

	/* Wireless Mode */
	if(wlanMode[i] == 0)
		apmode = "AP";
		
	if (wlanMode[i] == 1) 
	{
		if (networkType[0] == 0)
			apmode = "Infrastructure Client";
		else
			apmode = "Ad-hoc Client";
	}

	if ( wlanMode[i] == 2 )
		apmode = "WDS";
	if ( wlanMode[i] == 3 )
		apmode = "AP+WDS";

	/*#ifdef CONFIG_NEW_MESH_UI*/
	if( isNewMeshUI == 1 )
	{
		if ( wlanMode[i] == 4 )
			apmode = "AP+MESH";  	
		if ( wlanMode[i] == 5 )
			apmode = "MESH";
	}
	else
	{
		if ( wlanMode[i] == 4 )
			apmode = "AP+MPP";  	
		if ( wlanMode[i] == 5 )
			apmode = "MPP";
		if ( wlanMode[i] == 6 )
			apmode = "MAP";	
		if ( wlanMode[i] == 7 )
			apmode = "MP";  
	} 	

	/* Wireless Frequency */
	if (band[i] == 1)
   		apfreq = "2.4 GHz (B)";
    if (band[i] == 2)
   		apfreq = "2.4 GHz (G)";
    
    if (band[i] == 8)
   	{
    	if(channel[i] > 14)
    		apfreq = "5 GHz (N)";
    	else
   			apfreq = "2.4 GHz (N)";   		
   	}
   	
   	if (band[i] == 3)
   		apfreq = "2.4 GHz (B+G)";
    if (band[i] == 4)
   		apfreq = "5 GHz (A)";
   	if (band[i] == 10)
   		apfreq = "2.4 GHz (G+N)";
   	if (band[i] == 11)
   		apfreq = "2.4 GHz (B+G+N)";		
   	if (band[i] == 12)
   		apfreq = "5 GHz (A+N)";
	if (band[i] == 15)
   		apfreq = "2.4GHz+5 GHz (A+B+G+N)";

	/* Wireless Channel */ 
   	apchannel = channel[i];

	/* Wireless Security */ 
   	if (wlanMode[i] == 0 || wlanMode[i] == 1)
    	apsecmode = wep[i];
	else if (wlanMode[i] == 2)
    	apsecmode = wdsEncrypt[i];
	else if (wlanMode[i] == 3)
    	apsecmode = wep[i] + '(AP),  ' + wdsEncrypt[i] + '(WDS)';
	else if (wlanMode[i] == 4 || wlanMode[i] == 6)
    	apsecmode = wep[i] + '(AP),  ' + meshEncrypt[i] + '(Mesh)';    	
    else if (wlanMode[i] == 5|| wlanMode[i] == 7)
    	apsecmode = meshEncrypt[i] + '(Mesh)';	

	client_status = state_drv[i];
}



function resetchannel(index)
{
  if (index==0) {
    document.myform.wl_channel.options.length=0;
    document.myform.wl_channel.options[0]=new Option("Automatic", "0", false, false);
    document.myform.wl_channel.options[1]=new Option("1", "1", false, false);
    document.myform.wl_channel.options[2]=new Option("2", "2", false, false);
    document.myform.wl_channel.options[3]=new Option("3", "3", false, false);
    document.myform.wl_channel.options[4]=new Option("4", "4", false, false);
    document.myform.wl_channel.options[5]=new Option("5", "5", false, false);
    document.myform.wl_channel.options[6]=new Option("6", "6", true, false);
    document.myform.wl_channel.options[7]=new Option("7", "7", false, false);
    document.myform.wl_channel.options[8]=new Option("8", "8", false, false);
    document.myform.wl_channel.options[9]=new Option("9", "9", false, false);
    document.myform.wl_channel.options[10]=new Option("10", "10", false, false);
    document.myform.wl_channel.options[11]=new Option("11", "11", false, false);

	if(apchannel >= 1 && apchannel <= 11)
		document.getElementById("id_channel").value = apchannel;
	else
    	document.getElementById("id_channel").selectedIndex = 6;
  }
  else
  {
    document.myform.wl_channel.options.length=0;
    document.myform.wl_channel.options[0]=new Option("Automatic", "0", false, false);
    document.myform.wl_channel.options[1]=new Option("36", "36", false, false);
    document.myform.wl_channel.options[2]=new Option("40", "40", false, false);
    document.myform.wl_channel.options[3]=new Option("44", "44", true, false);
    document.myform.wl_channel.options[4]=new Option("48", "48", false, false);
    document.myform.wl_channel.options[5]=new Option("52", "52", false, false);
    document.myform.wl_channel.options[6]=new Option("56", "56", false, false);
    document.myform.wl_channel.options[7]=new Option("60", "60", false, false);
    document.myform.wl_channel.options[8]=new Option("64", "64", false, false);
    document.myform.wl_channel.options[9]=new Option("100", "100", false, false);
    document.myform.wl_channel.options[10]=new Option("104", "104", false, false);
    document.myform.wl_channel.options[11]=new Option("108", "108", false, false);
    document.myform.wl_channel.options[12]=new Option("112", "112", false, false);
    document.myform.wl_channel.options[13]=new Option("116", "116", false, false);
    document.myform.wl_channel.options[14]=new Option("120", "120", false, false);
    document.myform.wl_channel.options[15]=new Option("124", "124", false, false);
    document.myform.wl_channel.options[16]=new Option("128", "128", false, false);
    document.myform.wl_channel.options[17]=new Option("132", "132", false, false);
    document.myform.wl_channel.options[18]=new Option("136", "136", false, false);
    document.myform.wl_channel.options[19]=new Option("140", "140", false, false);
    document.myform.wl_channel.options[20]=new Option("149", "149", false, false);

	if(apchannel >= 36 && apchannel <= 149)
		document.getElementById("id_channel").value = apchannel;
	else
    	document.getElementById("id_channel").selectedIndex = 5;
  }
}

function doLoad()
{
    document.getElementById("id_ssid").value = apssid;

    if(apenb == 0)
    {
  	 	document.getElementById("id_on").checked = true;  	
    }
    else
    {
	 	document.getElementById("id_off").checked = true;		
    }

	if (apfreq.indexOf("2") != -1) {
	    document.getElementById("id_freq2").checked = true;	    
	} else {
	    document.getElementById("id_freq5").checked = true;	    
	}

	onClickFreq();

	document.getElementById("id_channel").value = apchannel;


	if (apmode == "AP" ) {
	    document.getElementById("id_modeap").checked = true;
	    document.getElementById("scan_btn").style.display="none";
	    document.getElementById("id_status").style.display="none";

		document.getElementById("id_channel").disabled = false;		
	}
	else {
	    document.getElementById("id_modeclient").checked = true;
	    document.getElementById("scan_btn").style.display="block";
	    document.getElementById("id_status").style.display="block";

    	document.getElementById("id_channel").disabled = true;		
	}

	onClickMode();		
	
	if(mode == 0) {
	    document.getElementById("id_security").selectedIndex = 0;
	    document.getElementById("id_password").style.display="none";
	    document.getElementById("id_psk").value = "";
	}
	else if(mode == 1) {
	    document.getElementById("id_security").selectedIndex = 1;
	    document.getElementById("id_psk").value = apwep;
	}
	else if(mode == 2) {
	    document.getElementById("id_security").selectedIndex = 2;
	    document.getElementById("id_psk").value = appsk;
	}
	else if(mode == 4) {
	    document.getElementById("id_security").selectedIndex = 3;
	    document.getElementById("id_psk").value = appsk;
	}

	onChangeSecurity();	

	if(client_status == "Connected")
	{
		document.getElementById("wl_client_status").innerHTML = "<font color=#008000>" + client_status + "</font>";
	}
	else
	{
		document.getElementById("wl_client_status").innerHTML = "<font color=#800000>" + client_status + "</font>";
	}	

	if(coexist)
		document.getElementById("id_chanwidth").value = "2";
	else
	{
		document.getElementById("id_chanwidth").value = chanwidth;
	}
}

function onChangeSecurity()
{
  if (document.getElementById("id_security").selectedIndex == 0) {
    document.getElementById("id_password").style.display="none";
  }
  else
  {
    document.getElementById("id_psk").disabled = false;
    document.getElementById("id_password").style.display="block";
  }
}

function onClickFreq()
{
  if (document.getElementById("id_freq2").checked) { 
     resetchannel(0);
  }
  else { 
    resetchannel(1);
  }
}

function onClickMode()
{
  if (document.getElementById("id_modeclient").checked) { 
    document.getElementById("scan_btn").style.display = "block";
	document.getElementById("id_status").style.display = "block";

	document.getElementById("id_channel").disabled = true;	
  }
  else { 
    document.getElementById("scan_btn").style.display = "none";
	document.getElementById("id_status").style.display = "none";

	document.getElementById("id_channel").disabled = false;	
  }
}

function doCheck()
{

 if (document.getElementById("id_security").selectedIndex == 1) {
     var i_key;
 
     i_key = document.getElementById("id_psk");
     if (i_key.value.length != 10 && i_key.value.length != 26 ) 
     {
       pop_up("WEP key length should be 10 or 26.", 0);
       return 0;
     }
 }

 if (document.getElementById("id_security").selectedIndex > 1) {
     var psk = document.getElementById("id_psk");
     if (psk.value.length < 8  || psk.value.length > 64 ) 
     {
       pop_up("PSK key length should be between 8 to 64.", 0);
       return 0;
     }
  }
  return 1;
}

function doCheckSsid(idname)
{
    var ssid ;
    var vssid ;
   
    //check SSID
    var rege=/[^a-zA-Z0-9]/;

    ssid = document.getElementById(idname);
    vssid = ssid.value;

    if (vssid == "")
    {
        pop_up("The Wireless Network Name must contain letters and/or numbers only with no spaces.",0);       
        return 0; 
    }

    for (var i=0; i<vssid.length; i++) {
        var mat = vssid.match(rege);
        if (mat) {
            if (mat.length > 0) {
               pop_up("The Wireless Network Name must contain letters and/or numbers only with no spaces.",0);              
	      	   return 0;
            }
        }
    }
    if (vssid.length > 32) {
          pop_up("The max length of Wireless Network Name is 32.",0);       
          return 0;
    } 
    return 1;
}

function do_scan()
{
    var form= document.myform;
 
    with (form) {
        command.disabled = false;
        command.value = "scan";
        mypage.value = "/wl_list.html";
    }
    form.submit();
}

function do_apply()
{
  var form= document.myform;

/*
  if (doCheckSsid("id_ssid")==0)
       return;
 */
 	
  if (doCheck()==0)
     return;
  
    with (form) {
        command.disabled = false;
        command.value = "apply";
    }
    form.submit();
}

function pop_return(flag)
{
	tips = 'The SSID must contain letters and/or numbers only with no spaces.';
	page = '0';

	browser_type();
	if ((typeof window.ActiveXObject != 'undefined') || (firefox_ver >= '3.0'))//support IE and firefox
	{
		pop_up(tips, page);
	}
	else
	{
		if(flag=="0")
			pop_up(tips,page);
		
		if (closewin == "1")
		{

		}
		setTimeout("pop_return(1)",1000);
	}
}
  
</SCRIPT>
</head>

<body>
<div id="wrapper">
  <!-- TOP NAV -->
  <%actInclude("top_nav.html")%>
  <!-- END TOP NAV -->
  <!-- SIDE NAV -->
  <%actInclude("left_wl.html")%>
  <!-- END SIDE NAV -->

  <!-- MAIN CONTENT AREA -->
  <div id="content_right">
    <div id="content_right_header"></div>
    <div id="content_right_contentarea">
      <h1>Wireless Basic Settings</h1>
      <form name="myform" action="wlquicksetup.cgi" method="POST" onSubmit="return do_apply();">
        <!--0--><input type="hidden" name="command" value="" disabled />
		<!--1--><input type="hidden" name="mypage" value="/wl_quicksetup.html" />
        <!--2--><input type="hidden" name="wait" value="1" />      
        <table>
           <tr>
             <td width="250">
             	<strong>Wireless radio:</strong>
             </td>
             <td><input name="wl_enb" id="id_on" type="radio" value="ON"  checked="checked"/>
             	 <label for="id_on">Enable</label>
             </td>
             <td><input name="wl_enb" id="id_off" type="radio" value="OFF" /> 
				 <label for="id_off">Disable</label>
             </td>
           </tr>
        </table>
     
        <table>
           <tr>
              <td width="250">
              	<strong>Wireless Operation Frequency:</strong>
              </td>
              <td><input name="wl_freq" id="id_freq2" type="radio" value="10" onClick="onClickFreq();" checked="checked"/> 
				  <label for="id_freq2">2.4GHz</label>
              </td>
              <td><input name="wl_freq" id="id_freq5" type="radio" value="11" onClick="onClickFreq();" />
              	  <label for="id_freq5">5GHz</label>              
              </td>
           </tr>
        </table>
                    
        <table>
           <tr>
	      	  <td width="250">
	      		<strong>Wireless Operation Mode:</strong>
              </td>
              <td><input name="wl_mode" id="id_modeap" type="radio" value="0" onClick="onClickMode();"  checked="checked"/>  
				  <label for="id_modeap">Wireless AP</label>
              </td>
              <td><input name="wl_mode" id="id_modeclient" type="radio" value="1" onClick="onClickMode();"  />
				  <label for="id_modeclient">Wireless Client</label>
              </td>
           </tr>
        </table>

                       
        <table id="id_status" >
           <tr>
              <td width="250">
	      		<strong>Wireless Client Status:</strong>
              </td>
              <td>
              	<span id="wl_client_status"></span>              	
              </td>
           </tr>
        </table>
                       
        <table>
           <tr>
              <td width="250">
	      		<strong>Wireless Network Name:</strong>
              </td>
              <td>
              <input name="wl_ssid" id="id_ssid" type="text" size="25" maxlength="32" style="margin:auto auto auto auto; line-height:12px;" />
              </td>
           </tr>
        </table>

        <table>
           <tr>
              <td width="250">
	      		<strong>Wireless Channel Width:</strong>
              </td>
              <td>
              	<select name="wl_chanwidth" id="id_chanwidth">
                 <option value="0">20MHz</option>
                 <option value="1">40MHz</option>
                 <option value="2">Auto</option>                 
                </select>
              </td>
           </tr>
        </table>

        <table>
            <tr>
              <td width="250">
	      		<strong>Wireless Security Type:</strong>
              </td>
              <td>
              <select name="wl_security" id="id_security" onchange="onChangeSecurity();">
                 <option value="0">Open</option>
                 <option value="1">WEP</option>
                 <option value="2">WPA PSK</option>
                 <option value="4">WPA2 PSK</option>

              </select>
              </td>
            </tr>
        </table>

       <table id="id_password" >
           <tr>
             <td width="250">
	     		<strong>Password Phrase:</strong>
             </td>
             <td>
             <input name="wl_psk" id="id_psk" type="text" size="25" maxlength="64" style="margin:auto auto auto auto; line-height:12px;" />
             </td>
           </tr>
        </table>

        <table>
           <tr>
              <td width="250">
	      		<strong>Wireless Channel:</strong>
              </td>
              <td width="50">
              <select name="wl_channel" id="id_channel" >
                 <option selected="selected">1 </option>
                 <option>2</option>
                 <option>3</option>
               </select>
              </td>
           </tr>
        </table>
   
       <table>
       <tr>
       <td width="50">
       </td>
       <td width="250">
       <a href="#" id="apply_btn" onclick="do_apply();" class="btn"></a>
       </td>
       <td>
       <a href="#" id="scan_btn" onclick="do_scan();" class="btn"></a>
       </td>
       </tr>
       </table>

        <div class="stepWrapper_footer"></div>
      </form>

     <div class="clear_left"></div>
     </div>
     <div id="content_right_footer"></div>
   </div>
   <div class="clear_left"></div>
   <%actInclude("wcb_footer.html")%>
</div>
</body>
</html>

